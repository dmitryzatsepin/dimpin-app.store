# Описание проекта ImportToSpa


## Обзор
ImportToSpa — это встраиваемое веб-приложение для CRM Битрикс24, предназначенное для импорта данных из файлов формата XLSX и CSV в смарт-процессы. Основная цель проекта — предоставить пользователям гибкий инструмент для массового создания и обновления элементов смарт-процессов с возможностью детального сопоставления полей, контроля дубликатов и обработки различных типов данных. Приложение разработано с учетом необходимости его установки на разные порталы Bitrix24 как локального приложения.

## Технологический стек и инструменты

### Языки программирования:
- **Backend**: PHP (без фреймворков)
- **Frontend**: TypeScript

### Фреймворки и библиотеки:
- **Frontend**: React
- **Сборка Frontend**: Vite
- **UI-компоненты**: Mantine
- **HTTP-клиент**: Axios
- **Парсинг файлов**: 
  - xlsx (для XLSX)
  - papaparse (для CSV)

### Базы данных и хранилища:
- Приложение не использует реляционные или NoSQL базы данных
- **Хранение данных**: Авторизационные токены и конфигурации для каждого портала хранятся в виде отдельных JSON-файлов на сервере

### Инструменты разработки и окружение:
- **Система контроля версий**: Git, GitHub
- **Менеджер пакетов (Frontend)**: pnpm
- **Целевая платформа**: REST API Битрикс24
- **Тестирование API**: Insomnia

## Структура и описание файлов
Проект имеет модульную структуру, разделяющую логику PHP и исходный код React.

### Корневая директория (`/importToSpa/`):
- `index.php`: Главная точка входа и роутер
- `config.php`: Конфигурационный файл
- `data/`: Папка для хранения данных (исключена из Git)
- `dist/`: Папка с собранными статическими файлами фронтенда
- `frontend/`: Исходный код React-приложения на TypeScript
- `includes/`: Вспомогательные PHP-модули
- `actions/`: Обработчики API-запросов от фронтенда

### Директория `includes/`:
- `auth_handler.php`: Обработчик аутентификации
- `api_helper.php`: Хелпер для работы с API
- `view_renderer.php`: Рендерер HTML

### Директория `actions/`:
- `get_smart_processes.php`: Обработка списка смарт-процессов
- `get_smart_process_fields.php`: Обработка полей смарт-процесса
- `import_data.php`: Основной обработчик импорта
- `import_helpers/`: Модули этапов импорта:
  - `1_prepare_data.php`: Подготовка данных
  - `2_find_duplicates.php`: Поиск дубликатов
  - `3_execute_import.php`: Выполнение импорта

## Функциональность и возможности
- **Интеграция с Bitrix24**: OAuth 2.0 аутентификация
- **Выбор смарт-процесса**: Автоматическая загрузка доступных процессов
- **Загрузка и парсинг файлов**: Поддержка .xlsx и .csv
- **Сопоставление полей (Маппинг)**: Гибкое сопоставление полей
- **Контроль дубликатов**: Поиск по TITLE перед созданием
- **Обработка типов данных**:
  - Пользователь (employee/user)
  - Списки, Даты, Да/Нет
- **Пользовательский интерфейс**:
  - Пошаговый интерфейс
  - Информативное модальное окно статуса
  - Детальные ошибки и предупреждения
  - Возможность нового импорта без перезагрузки

## Контекст для новых сессий
### Цели проекта:
Создать надежный и удобный инструмент для импорта данных в смарт-процессы Bitrix24.

### Текущий статус:
Основной функционал реализован и отлажен.

### Будущие направления и доработки:
- Сохранение и загрузка пресетов маппинга
- Улучшение обработки множественных полей
- Добавление "строгого" режима импорта
- Продвинутый UI для списочных полей
- Оптимизация для больших файлов (50-100k строк)

## Заключение
Проект ImportToSpa представляет собой рабочее решение для сложной задачи импорта данных в смарт-процессы Bitrix24. Текущая модульная архитектура и подробная документация закладывают прочную основу для дальнейшего развития.
