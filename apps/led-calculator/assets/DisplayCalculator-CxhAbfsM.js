import{r as u,j as e,G as j,N as P,T as f,S as Me,b as R,C as E,c as A,L as B,d as S,e as se,f as ze,B as $,A as N,g as Fe,h as Oe,P as D,i as k,k as c,l as Le,m as $e,I as Ne,n as qe,D as We}from"./ui-CFZjDxNi.js";import{c as Ue}from"./utils-DZz9GRF_.js";import{u as He,a as Ve,b as M,c as ne}from"./index-wlRjH8Dl.js";import"./vendor-BYOhtk1D.js";var _e={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}};const q=(r,s,n,t)=>{const a=u.forwardRef(({color:o="currentColor",size:l=24,stroke:d=2,title:i,className:m,children:h,...p},g)=>u.createElement("svg",{ref:g,..._e[r],width:l,height:l,className:["tabler-icon",`tabler-icon-${s}`,m].join(" "),strokeWidth:d,stroke:o,...p},[i&&u.createElement("title",{key:"svg-title"},i),...t.map(([b,y])=>u.createElement(b,y)),...Array.isArray(h)?h:[h]]));return a.displayName=`${n}`,a};var Ge=q("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);var Ze=q("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);var Ke=q("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const Xe=u.createContext(null),L={didCatch:!1,error:null};class Je extends u.Component{constructor(s){super(s),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=L}static getDerivedStateFromError(s){return{didCatch:!0,error:s}}resetErrorBoundary(){const{error:s}=this.state;if(s!==null){for(var n,t,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];(n=(t=this.props).onReset)===null||n===void 0||n.call(t,{args:o,reason:"imperative-api"}),this.setState(L)}}componentDidCatch(s,n){var t,a;(t=(a=this.props).onError)===null||t===void 0||t.call(a,s,n)}componentDidUpdate(s,n){const{didCatch:t}=this.state,{resetKeys:a}=this.props;if(t&&n.error!==null&&Qe(s.resetKeys,a)){var o,l;(o=(l=this.props).onReset)===null||o===void 0||o.call(l,{next:a,prev:s.resetKeys,reason:"keys"}),this.setState(L)}}render(){const{children:s,fallbackRender:n,FallbackComponent:t,fallback:a}=this.props,{didCatch:o,error:l}=this.state;let d=s;if(o){const i={error:l,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")d=n(i);else if(t)d=u.createElement(t,i);else if(a!==void 0)d=a;else throw l}return u.createElement(Xe.Provider,{value:{didCatch:o,error:l,resetErrorBoundary:this.resetErrorBoundary}},d)}}function Qe(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r.length!==s.length||r.some((n,t)=>!Object.is(n,s[t]))}const Ye=({width:r,height:s,onWidthChange:n,onHeightChange:t,disabled:a=!1})=>e.jsxs(e.Fragment,{children:[e.jsx(j.Col,{span:{base:12,sm:6},children:e.jsx(P,{label:"–®–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞, –º–º",placeholder:"–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É",value:r,onChange:n,min:1,step:50,allowDecimal:!1,allowNegative:!1,required:!0,disabled:a})}),e.jsx(j.Col,{span:{base:12,sm:6},children:e.jsx(P,{label:"–í—ã—Å–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞, –º–º",placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤—ã—Å–æ—Ç—É",value:s,onChange:t,min:1,step:1,allowDecimal:!1,allowNegative:!1,required:!0,disabled:a})})]}),et=({data:r,value:s,onChange:n,disabled:t=!1})=>!r||r.length===0?e.jsx(f,{c:"dimmed",size:"sm",children:"–¢–∏–ø—ã —ç–∫—Ä–∞–Ω–æ–≤ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã"}):e.jsx(Me,{data:r,value:s??"",onChange:n,fullWidth:!0,color:"blue",disabled:t}),tt=({options:r,value:s,onChange:n,disabled:t=!1,required:a=!1,label:o="–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ",placeholder:l="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ"})=>e.jsx(R,{label:o,placeholder:l,data:r,value:s,onChange:n,disabled:t||r.length===0,clearable:!0,searchable:!0,required:a,nothingFoundMessage:"–ù–µ –Ω–∞–π–¥–µ–Ω–æ"}),rt=({options:r,value:s,onChange:n,disabled:t=!1,required:a=!1,label:o="–ú–∞—Ç–µ—Ä–∏–∞–ª –∫–∞–±–∏–Ω–µ—Ç–∞",placeholder:l="–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª"})=>e.jsx(R,{label:o,placeholder:l,data:r,value:s,onChange:n,disabled:t||r.length===0,clearable:!0,searchable:!0,required:a,nothingFoundMessage:"–ù–µ –Ω–∞–π–¥–µ–Ω–æ"}),st=({options:r,value:s,onChange:n,disabled:t=!1,required:a=!1,label:o="–°—Ç–µ–ø–µ–Ω—å –∑–∞—â–∏—Ç—ã (IP)",placeholder:l="–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–µ–ø–µ–Ω—å –∑–∞—â–∏—Ç—ã"})=>e.jsx(R,{label:o,placeholder:l,data:r,value:s,onChange:n,disabled:t,required:a,searchable:!0,clearable:!0,nothingFoundMessage:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"}),nt=({options:r,value:s,onChange:n,disabled:t=!1,label:a="–°–µ–Ω—Å–æ—Ä—ã",description:o})=>r.length===0&&!t?e.jsx(f,{size:"sm",c:"dimmed",children:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤."}):r.length===0&&t?null:e.jsx(E.Group,{value:s,onChange:n,label:a,description:o,children:e.jsx(A,{mt:"xs",gap:"xs",children:r.map(l=>e.jsx(E,{value:l.value,label:l.label,disabled:t},l.value))})}),lt=({options:r,value:s,onChange:n,disabled:t=!1,label:a="–¢–∏–ø —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",description:o})=>r.length===0&&!t?e.jsx(f,{size:"sm",c:"dimmed",children:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è."}):r.length===0&&t?null:e.jsx(E.Group,{value:s,onChange:n,label:a,description:o,children:e.jsx(A,{mt:"xs",gap:"xs",children:r.map(l=>e.jsx(E,{value:l.value,label:l.label,disabled:t},l.value))})}),at=({options:r,value:s,onChange:n,disabled:t=!1,required:a=!1,label:o="–®–∞–≥ –ø–∏–∫—Å–µ–ª—è",placeholder:l="–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–≥",loading:d=!1,size:i})=>e.jsx(R,{label:o,placeholder:l,data:r,value:s,onChange:n,disabled:t||r.length===0,clearable:!0,searchable:!0,required:a,nothingFoundMessage:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à–∞–≥–æ–≤ –ø–∏–∫—Å–µ–ª—è",limit:100,rightSection:d?e.jsx(B,{size:"xs"}):null,size:i}),ot=({options:r,value:s,onChange:n,disabled:t=!1,required:a=!0,loading:o=!1,label:l="–ö–∞–±–∏–Ω–µ—Ç",placeholder:d="–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç"})=>{const i=()=>o?"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–æ–≤...":t&&!o?"–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—à–µ":!r.length&&!o&&!t?"–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤":d;return e.jsx(R,{label:l,placeholder:i(),data:r,value:s,onChange:n,disabled:t||o||r.length===0&&!o,clearable:!0,searchable:!0,required:a,nothingFoundMessage:"–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤",limit:100,rightSection:o?e.jsx(B,{size:"xs"}):null})},it=({checked:r,onChange:s,disabled:n=!1,label:t="–ì–∏–±–∫–∏–π —ç–∫—Ä–∞–Ω",description:a="–í—ã–±—Ä–∞—Ç—å, –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –∏–º–µ–µ—Ç –≥–∏–±–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É"})=>e.jsxs(S,{wrap:"nowrap",gap:"sm",align:"center",children:[e.jsx(se,{checked:r,onChange:o=>s(o.currentTarget.checked),disabled:n,"aria-label":t}),e.jsxs("div",{children:[e.jsx(f,{size:"sm",children:t}),a&&e.jsx(f,{size:"xs",c:"dimmed",children:a})]})]}),ct=({value:r,onChange:s,disabled:n=!1,loading:t=!1,label:a="–ö—É—Ä—Å",placeholder:o="–í–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å...",required:l=!0,size:d,style:i})=>{const m=()=>t?"–ó–∞–≥—Ä—É–∑–∫–∞ ...":o,h=e.jsx("span",{style:{fontSize:ze(18)},children:"üí≤"});return e.jsx(P,{label:a,placeholder:m(),value:r,onChange:s,disabled:n||t,required:l,allowDecimal:!0,decimalScale:2,step:.01,min:0,leftSection:h,leftSectionWidth:36,rightSection:t?e.jsx(B,{size:"xs"}):null,rightSectionWidth:t?36:0,size:d,style:i})},dt=({onClick:r,loading:s=!1,disabled:n=!1,label:t="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å",size:a})=>e.jsx($,{leftSection:"üßÆ",onClick:r,loading:s,disabled:n,fullWidth:!0,mt:"lg",size:a,children:t}),ht=({checked:r,onChange:s,disabled:n})=>e.jsx(S,{justify:"flex-start",h:"100%",children:e.jsx(se,{checked:r,onChange:t=>s(t.currentTarget.checked),disabled:n,labelPosition:"left",label:e.jsx(f,{fw:500,size:"sm",children:"PRO"}),size:"md"})}),ut=()=>{const{selectedScreenTypeCode:r,selectedLocationCode:s,selectedMaterialCode:n,selectedProtectionCode:t,selectedSensorCodes:a,selectedControlTypeCodes:o,selectedPitchCode:l,selectedCabinetCode:d,isFlexSelected:i,isProVersionSelected:m,widthMm:h,heightMm:p,localDollarRateInput:g,setSelectedScreenTypeCode:b,setSelectedLocationCode:y,setSelectedMaterialCode:w,setSelectedProtectionCode:W,setSelectedSensorCodes:U,setSelectedControlTypeCodes:H,setSelectedPitchCode:V,setSelectedCabinetCode:_,setIsFlexSelected:G,setIsProVersionSelected:Z,setWidthMm:ae,setHeightMm:oe,setLocalDollarRateInput:I}=He(),{isLoadingInitialData:C,isErrorInitialData:K,errorInitialData:ie,isLoadingPitches:z,isErrorPitches:ce,errorPitches:de,isLoadingModules:F,isLoadingCabinets:X,isErrorCabinets:he,errorCabinets:ue,isLoadingDollarRate:ge,hasProOption:xe,dollarRateValue:v,screenTypeSegments:me,locationSelectOptions:J,materialSelectOptions:Q,protectionSelectOptions:Y,sensorSelectOptions:pe,controlTypeSelectOptions:je,pitchSelectOptions:ee,cabinetSelectOptions:be,isFlexOptionAvailableForSelectedScreenType:Ce}=Ve(),{isCalculating:fe,isCalculationReady:ye,performCalculation:te}=M();u.useEffect(()=>{typeof v=="number"&&v>0&&v!==g&&I(v)},[v,I,g]);const re=u.useMemo(()=>+h>0&&+p>0,[h,p]),O=r==="cabinet",Te=u.useCallback(x=>b(x),[b]),Se=u.useCallback(x=>y(x),[y]),we=u.useCallback(x=>w(x),[w]),ve=u.useCallback(x=>W(x),[W]),Pe=u.useCallback(x=>U(x),[U]),Re=u.useCallback(x=>H(x),[H]),ke=u.useCallback(x=>V(x),[V]),Ie=u.useCallback(x=>Z(x),[Z]),Ee=u.useCallback(x=>_(x),[_]),Ae=u.useCallback(x=>G(x),[G]),De=u.useCallback(x=>I(x),[I]),Be=u.useCallback(()=>te(),[te]);return e.jsxs(A,{gap:"md",children:[e.jsx(Fe,{visible:C,overlayProps:{radius:"sm",blur:2},loaderProps:{children:e.jsx(B,{})}}),C&&e.jsx(f,{ta:"center",children:"–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."}),!C&&K&&e.jsx(N,{title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö",color:"red",icon:e.jsx(Ge,{size:16}),radius:"sm",children:ie?.message??"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ."}),!C&&!K&&e.jsxs(e.Fragment,{children:[e.jsx(et,{data:me,value:r,onChange:Te,disabled:C}),Ce&&e.jsx(it,{checked:i,onChange:Ae}),e.jsxs(j,{children:[e.jsx(Ye,{width:h,height:p,onWidthChange:ae,onHeightChange:oe,disabled:C}),e.jsx(j.Col,{span:{base:12,md:6},children:e.jsxs(A,{gap:"md",children:[e.jsx(tt,{options:J,value:s,onChange:Se,disabled:C||!r||!re||J.length===0,required:!0}),e.jsx(st,{options:Y,value:t,onChange:ve,disabled:C||!s||Y.length===0,required:!0})]})}),e.jsx(j.Col,{span:{base:12,md:6},children:e.jsxs(j,{children:[e.jsx(j.Col,{span:{base:12,sm:4},children:e.jsx(nt,{options:pe,value:a,onChange:Pe,disabled:!0})}),e.jsx(j.Col,{span:{base:12,sm:8},children:e.jsx(lt,{options:je,value:o,onChange:Re,disabled:!0})})]})}),e.jsx(j.Col,{span:12,mt:"md",children:O&&e.jsx(rt,{options:Q,value:n,onChange:we,disabled:C||!s||Q.length===0,required:!0})}),e.jsxs(j.Col,{span:12,children:[e.jsxs(j,{mt:"md",align:"center",gutter:"xl",children:[e.jsx(j.Col,{span:4,children:e.jsx(at,{options:ee,value:l,onChange:ke,disabled:C||!re||!s||!t||O&&!n||z||ee.length===0,loading:z,required:!0,placeholder:s?z?"–ó–∞–≥—Ä—É–∑–∫–∞...":"–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–≥ –ø–∏–∫—Å–µ–ª—è":"–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ"})}),e.jsx(j.Col,{span:2,style:{marginTop:"20px"},children:e.jsx(ht,{checked:m,onChange:Ie,disabled:!xe||F})}),O&&e.jsx(j.Col,{span:6,children:e.jsx(ot,{options:be,value:d,onChange:Ee,loading:F||X,disabled:!l||F||X,required:!0})})]}),ce&&e.jsxs(f,{c:"red",size:"sm",mt:"xs",children:[" –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–≥–æ–≤ –ø–∏–∫—Å–µ–ª—è: ",de?.message??"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"," "]}),he&&e.jsxs(f,{c:"red",size:"sm",mt:"xs",children:[" –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–±–∏–Ω–µ—Ç–æ–≤: ",ue?.message??"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"," "]})]}),e.jsx(j.Col,{span:12,mt:"md",children:e.jsxs(S,{grow:!0,preventGrowOverflow:!1,align:"flex-end",wrap:"nowrap",children:[e.jsx(ct,{value:g,onChange:De,disabled:C,loading:ge,required:!0,size:"sm",style:{flexBasis:"150px",flexGrow:0}}),e.jsx(dt,{onClick:Be,loading:fe,disabled:!ye,size:"sm"})]})})]})]})]})},gt=()=>e.jsx(Ue,{children:({reset:r})=>e.jsx(Je,{onReset:r,fallbackRender:({error:s,resetErrorBoundary:n})=>e.jsxs(N,{title:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã",color:"red",radius:"sm",withCloseButton:!0,onClose:n,children:["–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ",s?.message??"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",e.jsx($,{onClick:n,variant:"outline",color:"red",size:"xs",mt:"sm",children:"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"})]}),children:e.jsx(ut,{})})});class xt{static async makeRequest(s,n,t,a){const o=`https://${s}/rest/${n}`;console.log("üîç Bitrix24 API Request Details:",{url:o,method:"POST",params:t,timestamp:new Date().toISOString()});try{const l=new URLSearchParams;a&&l.append("auth",a),Object.entries(t).forEach(([m,h])=>{typeof h=="object"&&h!==null&&!Array.isArray(h)?Object.entries(h).forEach(([p,g])=>{l.append(`${m}[${p}]`,String(g))}):l.append(m,String(h))}),console.log("üì§ URLSearchParams contents:"),console.log("  Raw:",l.toString()),console.log("  Decoded:",decodeURIComponent(l.toString()));const d=await fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l});if(console.log("üì• Response received:",{status:d.status,statusText:d.statusText,headers:Object.fromEntries(d.headers.entries())}),!d.ok){const m=await d.text();throw console.error("‚ùå HTTP Error Response Body:",m),new Error(`HTTP error! status: ${d.status}, body: ${m}`)}const i=await d.json();if(console.log("‚úÖ API Response:",i),i.error)throw console.error("‚ùå Bitrix24 API Error:",{error:i.error,description:i.error_description,fullResponse:i}),new Error(`Bitrix24 API error: ${i.error_description||i.error}`);return i.result}catch(l){throw console.error("üí• Bitrix24 API request failed:",{error:l instanceof Error?l.message:String(l),stack:l instanceof Error?l.stack:"No stack trace",url:o,params:t}),l}}static async createSmartProcess(s,n){const{domain:t,dealId:a,userId:o}=s;console.log("üöÄ Creating Smart Process with params:",{domain:t,dealId:a,userId:o}),console.log("üîç Full params object:",s),console.log("üîç Calculation data sample:",{screenType:n.techSpecs?.screenType,totalCost:n.costs?.totalCost,screenSize:`${n.techSpecs?.actualScreenWidthM||0} x ${n.techSpecs?.actualScreenHeightM||0} –º`});const l={entityTypeId:"1104",fields:{TITLE:`–†–∞—Å—á–µ—Ç LED —ç–∫—Ä–∞–Ω–∞ –¥–ª—è —Å–¥–µ–ª–∫–∏ ${a}`,PARENT_ID_2:String(a)}};console.log("üîç Smart Process Data validation:",{dealIdType:typeof a,dealIdValue:a,entityTypeIdType:typeof l.entityTypeId}),console.log("üìã Smart Process Data prepared:",{entityTypeId:l.entityTypeId,fieldsCount:Object.keys(l.fields).length,fields:l.fields});try{const d=await this.makeRequest(t,"crm.item.add",l,s.authId);return console.log("‚úÖ Smart Process created successfully:",d),d}catch(d){throw console.error("‚ùå Error creating Smart Process:",{error:d instanceof Error?d.message:String(d),stack:d instanceof Error?d.stack:"No stack trace",smartProcessData:l}),d}}static async updateDeal(s,n){const{domain:t,dealId:a}=s,o={id:a,fields:{UF_CRM_DEAL_LED_CALCULATION:JSON.stringify(n),UF_CRM_DEAL_LED_SCREEN_SIZE:`${n.techSpecs?.actualScreenWidthM||0} x ${n.techSpecs?.actualScreenHeightM||0} –º`,UF_CRM_DEAL_LED_TOTAL_COST:n.costs?.totalCost||0}};try{return await this.makeRequest(t,"crm.deal.update",o,s.authId)}catch(l){throw console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏:",l),l}}static async sendCalculationData(s,n){try{console.log("–ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ –ë–∏—Ç—Ä–∏–∫—Å24:",{params:s,calculationData:n});const t=await this.createSmartProcess(s,n);console.log("–°–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ:",t);const a=await this.updateDeal(s,n);return console.log("–°–¥–µ–ª–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ:",a),{smartProcess:t,dealUpdate:a,success:!0}}catch(t){throw console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–∏—Ç—Ä–∏–∫—Å24:",t),t}}}const mt=({onClick:r,loading:s=!1,disabled:n=!1,isBitrix24Available:t=!0,size:a,...o})=>{const l=e.jsx($,{leftSection:t?"üì§":"‚ö†Ô∏è",onClick:r,loading:s,disabled:n||!t,size:a,variant:t?"gradient":"light",gradient:t?{from:"blue",to:"cyan",deg:90}:void 0,color:t?void 0:"gray",...o,children:t?"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –ë–∏—Ç—Ä–∏–∫—Å24":"–ë–∏—Ç—Ä–∏–∫—Å24 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"});return t?l:e.jsx(Oe,{label:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤ iframe –ë–∏—Ç—Ä–∏–∫—Å24 –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã",children:l})},T=r=>r==null?"-":r.toLocaleString("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:2,maximumFractionDigits:2}),le=(r,s)=>e.jsx(c.Tfoot,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Td,{colSpan:3,style:{textAlign:"right",fontWeight:"bold"},children:r}),e.jsx(c.Td,{style:{textAlign:"right",fontWeight:"bold"},children:T(s)})]})}),pt=(r,s)=>e.jsx(c.Tfoot,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Td,{style:{textAlign:"right",fontWeight:"bold"},children:r}),e.jsx(c.Td,{style:{textAlign:"right",fontWeight:"bold"},children:T(s)})]})}),jt=(r,s,n)=>!r||r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(k,{order:5,mt:"xl",mb:"xs",children:s}),e.jsxs(c,{highlightOnHover:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{children:"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ"}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–ö–æ–ª-–≤–æ"}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–¶–µ–Ω–∞ –∑–∞ –µ–¥."}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–°—Ç–æ–∏–º–æ—Å—Ç—å"})]})}),e.jsx(c.Tbody,{children:r.map((t,a)=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:t.label}),e.jsx(c.Td,{style:{textAlign:"right"},children:t.quantity}),e.jsx(c.Td,{style:{textAlign:"right"},children:T(t.unitPriceRub)}),e.jsx(c.Td,{style:{textAlign:"right"},children:T(t.totalPriceRub)})]},`${s}-${a}`))}),le("–ò—Ç–æ–≥–æ:",n)]})]}),bt=(r,s,n)=>!r||r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(k,{order:5,mt:"xl",mb:"xs",children:"–ö–æ–º–ø–ª–µ–∫—Ç –ó–ò–ü"}),e.jsxs(c,{highlightOnHover:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{children:"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ"}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–ö–æ–ª-–≤–æ"}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–¶–µ–Ω–∞ –∑–∞ –µ–¥."}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–°—Ç–æ–∏–º–æ—Å—Ç—å"})]})}),e.jsx(c.Tbody,{children:r.map((t,a)=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:t.label}),e.jsx(c.Td,{style:{textAlign:"right",width:120},children:e.jsx(P,{value:t.quantity,onChange:o=>{const l=r.map(d=>d.label===t.label?{...d,quantity:Number(o)||0}:d);s(l)},min:0,step:1,hideControls:!0,styles:{input:{textAlign:"right"}}})}),e.jsx(c.Td,{style:{textAlign:"right"},children:T(t.unitPriceRub)}),e.jsx(c.Td,{style:{textAlign:"right"},children:T(t.totalPriceRub)})]},`zip-${a}`))}),le("–ò—Ç–æ–≥–æ –ó–ò–ü:",n)]})]}),Ct=(r,s,n)=>!r||r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(k,{order:5,mt:"xl",mb:"xs",children:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –∏ —Ä–∞–±–æ—Ç—ã"}),e.jsxs(c,{highlightOnHover:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(c.Thead,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Th,{children:"–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ"}),e.jsx(c.Th,{style:{textAlign:"right"},children:"–°—Ç–æ–∏–º–æ—Å—Ç—å"})]})}),e.jsx(c.Tbody,{children:r.map((t,a)=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:t.label}),e.jsx(c.Td,{style:{textAlign:"right",width:180},children:e.jsx(P,{value:t.totalPriceRub,onChange:o=>{const l=Number(o)||0,d=r.map(i=>i.label===t.label?{...i,totalPriceRub:l,unitPriceRub:l}:i);s(d)},min:0,step:1e3,hideControls:!0,styles:{input:{textAlign:"right"}},thousandSeparator:" "})})]},`additional-${a}`))}),pt("–ò—Ç–æ–≥–æ –¥–æ–ø. —É—Å–ª—É–≥–∏:",n)]})]}),ft=()=>{const{costDetails:r,editableZipItems:s,setEditableZipItems:n,editableAdditionalItems:t,setEditableAdditionalItems:a}=M();if(!r)return null;const o=u.useMemo(()=>{const l=r.costItems.reduce((h,p)=>h+p.totalPriceRub,0),d=s.map(h=>({...h,totalPriceRub:h.quantity*(h.unitPriceRub??0)})),i=d.reduce((h,p)=>h+p.totalPriceRub,0),m=t.reduce((h,p)=>h+p.totalPriceRub,0);return{mainTotal:l,zipTotal:i,additionalTotal:m,grandTotal:l+i+m,updatedZipItems:d}},[r,s,t]);return e.jsxs(D,{shadow:"sm",p:"lg",mt:"md",withBorder:!0,children:[e.jsx(k,{order:5,mb:"md",children:"–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏"}),jt(r.costItems,"–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è",o.mainTotal),bt(o.updatedZipItems,n,o.zipTotal),Ct(t,a,o.additionalTotal),e.jsxs("div",{style:{marginTop:"40px",borderTop:"1px solid #e0e0e0",paddingTop:"15px",textAlign:"right",fontWeight:"bold",fontSize:"1.2em"},children:["–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ",T(o.grandTotal)]}),r.conversionRate&&e.jsxs("div",{style:{marginTop:"5px",textAlign:"right",fontSize:"0.9em",color:"#666"},children:["(–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ USD-RUB: ",r.conversionRate.toFixed(2),")"]})]})},yt=()=>{const{calculationResult:r,costDetails:s,bitrix24Params:n,isBitrix24Available:t}=M(),[a,o]=u.useState(!1),[l,d]=u.useState(null),i=r;if(!i)return e.jsx(N,{icon:"‚ö†Ô∏è",title:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",color:"gray",mt:"md",children:"–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã."});const m=async()=>{if(!i||!n){d({success:!1,message:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–∏—Ç—Ä–∏–∫—Å24 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"});return}o(!0),d(null);try{const g={techSpecs:i,costs:s};console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ë–∏—Ç—Ä–∏–∫—Å24:",{params:n,data:g});const b=await xt.sendCalculationData(n,g);console.log("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –ë–∏—Ç—Ä–∏–∫—Å24:",b),d({success:!0,message:`–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –°–æ–∑–¥–∞–Ω —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å ID: ${b.smartProcess?.id||"N/A"}`})}catch(g){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ë–∏—Ç—Ä–∏–∫—Å:",g),d({success:!1,message:`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${g instanceof Error?g.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`})}finally{o(!1)}},h=(g,b=2,y="")=>{if(g==null||isNaN(g))return"-";const w=g.toLocaleString("ru-RU",{minimumFractionDigits:b,maximumFractionDigits:b});return y?`${w} ${y}`:w},p=[{icon:"üìç",label:"–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞",value:i.placement},{icon:"üìê",label:"–®–∞–≥ –ø–∏–∫—Å–µ–ª—è",value:i.pixelPitch},{icon:"üìê",label:"–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞",value:`${i.resolution} –ø–∏–∫—Å.`},{icon:"üìê",label:"–í—Å–µ–≥–æ –ø–∏–∫—Å–µ–ª–µ–π",value:h(i.totalPixels,0,"–ø–∏–∫—Å.")},{icon:"üìê",label:"–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã (–®x–í)",value:`${h(i.actualScreenWidthM)} x ${h(i.actualScreenHeightM)} –º`},{icon:"üìê",label:"–ü–ª–æ—â–∞–¥—å —ç–∫—Ä–∞–Ω–∞",value:h(i.activeAreaM2,2,"–º¬≤")},{icon:"üìê",label:"–Ø—Ä–∫–æ—Å—Ç—å",value:i.brightness},{icon:"üìê",label:"–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",value:i.refreshRate},{icon:"üìê",label:"–ó–∞—â–∏—Ç–∞ IP",value:i.ipProtection},{icon:"üìê",label:"–£–≥–ª—ã –æ–±–∑–æ—Ä–∞ (–ì¬∞x–í¬∞)",value:`${i.horizontalViewingAngle} x ${i.verticalViewingAngle}`},{icon:"üìè",label:"–î–∏—Å—Ç–∞–Ω—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –º",value:h(i.pixelPitchValue,2,"–º")},...i.cabinetsCountTotal>0?[{icon:"üîß",label:"–¢–∏–ø –∫–∞–±–∏–Ω–µ—Ç–∞",value:i.material},{icon:"üîß",label:"–†–∞–∑–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞ (–®x–í)",value:i.cabinetSize},{icon:"üîß",label:"–ö–∞–±–∏–Ω–µ—Ç–æ–≤ (–®x–í / –í—Å–µ–≥–æ)",value:`${i.cabinetsCountHorizontal} x ${i.cabinetsCountVertical} / ${i.cabinetsCountTotal} —à—Ç.`},{icon:"üîß",label:"–ú–æ–¥—É–ª–µ–π –≤ –∫–∞–±–∏–Ω–µ—Ç–µ",value:h(i.modulesPerCabinet,0,"—à—Ç.")}]:[],{icon:"üîß",label:"–ú–æ–¥—É–ª–µ–π –≤—Å–µ–≥–æ",value:h(i.modulesCountTotal,0,"—à—Ç.")},{icon:"‚ö°",label:"–°—Ä–µ–¥–Ω–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –∫–í—Ç",value:h(i.averagePowerConsumption,2,"–∫–í—Ç")},{icon:"‚ö°",label:"–ú–∞–∫—Å. –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –∫–í—Ç",value:h(i.maxPowerConsumption,2,"–∫–í—Ç")}];return e.jsxs(D,{shadow:"sm",p:"lg",mt:"md",withBorder:!0,children:[e.jsx(c,{highlightOnHover:!0,verticalSpacing:"sm",withTableBorder:!0,withColumnBorders:!0,children:e.jsx(c.Tbody,{children:p.map((g,b)=>e.jsxs(c.Tr,{children:[e.jsx(c.Td,{width:"50%",children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"16px",marginRight:"8px"},children:g.icon}),e.jsxs(f,{fw:500,size:"sm",children:[g.label,":"]})]})}),e.jsx(c.Td,{width:"50%",children:e.jsx(f,{size:"sm",children:g.value})})]},b))})}),e.jsx(ft,{}),e.jsx(S,{justify:"flex-end",mt:"xl",children:e.jsx(mt,{onClick:m,loading:a,disabled:a,isBitrix24Available:t,size:"sm"})}),l&&e.jsx(Le,{icon:l.success?"‚úÖ":"‚ùå",color:l.success?"green":"red",title:l.success?"–û—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞!":"–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å!",mt:"md",withCloseButton:!0,onClose:()=>d(null),children:l.message})]})},Tt=({showDetails:r=!1})=>{const[s,n]=u.useState(null),[t,a]=u.useState(r);return ne(),null},kt=()=>{console.log("üöÄ DisplayCalculator component rendering");const{isDrawerOpen:r,setIsDrawerOpen:s,isBitrix24Available:n}=M();console.log("üîç DisplayCalculator Debug:",{isBitrix24Available:n,url:window.location.href,search:window.location.search});const{measureFormRender:t}=ne();return u.useEffect(()=>{t()},[t]),e.jsxs(e.Fragment,{children:[e.jsxs($e,{size:"lg",my:"md",children:[e.jsxs(S,{justify:"space-between",align:"center",mb:"lg",children:[e.jsx(S,{gap:"md",align:"center",children:e.jsx(D,{bg:"gray.5",p:"md",pt:"xs",px:50,radius:"md",withBorder:!0,shadow:"xs",w:90,h:55,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ne,{src:"https://cdn-ru.bitrix24.ru/b29272776/disk/c50/c5013cb925a4e55484a4f67d0d1523da/73e120f5e9f3cc8a95cb600a8fd0b918.png",alt:"–õ–æ–≥–æ—Ç–∏–ø",w:80,h:45,fit:"contain"})})}),e.jsx(k,{order:1,size:"h2",ta:"center",flex:1,c:"gray.7",children:"–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä LED —ç–∫—Ä–∞–Ω–æ–≤"}),e.jsx(qe,{leftSection:n?e.jsx(Ze,{size:12}):e.jsx(Ke,{size:12}),color:n?"green":"red",variant:"light",children:n?"–ë–∏—Ç—Ä–∏–∫—Å24 –ø–æ–¥–∫–ª—é—á–µ–Ω":"–ë–∏—Ç—Ä–∏–∫—Å24 –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"})]}),e.jsx(D,{shadow:"xs",p:"xl",withBorder:!0,radius:"md",children:e.jsx(gt,{})}),e.jsx(We,{opened:r,onClose:()=>s(!1),title:"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞",position:"right",size:"xl",padding:"md",shadow:"sm",overlayProps:{backgroundOpacity:.5,blur:4},transitionProps:{transition:"slide-left",duration:250,timingFunction:"ease"},children:e.jsx(yt,{})})]}),e.jsx(Tt,{showDetails:!0})]})};export{kt as default};
